---
rule:
  pv_md2:
    vertices:
      - label: Person.Natural
        props:
          Full_Name:
            val: "${name?.trim().toUpperCase()}"
            mandatoryInSearch: true
          Type:
            val: "colaborador"
            excludeFromSearch: true
          Customer_ID: "${document?.replaceAll('[^0-9]', '')}"

      - label: Object.Identity_Card
        props:
          Id_Value:
            val: "${document.replaceAll('[^0-9]','')}"
            mandatoryInSearch: true
          Id_Type:
            val: "CPF"
            excludeFromSearch: true

      - label: Object.Email_Address
        props:
          Email:
            val: "${email?.trim()?.toLowerCase()}"
            mandatoryInSearch: true

      - label: Event.Ingestion
        props:
          Type:
            val: MD2
            excludeFromSearch: true
          Operation:
            val: Unstructured Data Insertion
            excludeFromSearch: true
          Domain_b64:
            val: "${original_request?.bytes?.encodeBase64()?.toString()}"
            excludeFromSearch: true
          Metadata_Create_Date:
            val: "${new Date()}"
            excludeFromSearch: true
            type: java.util.Date

      - label: Object.Data_Source
        props:
          Name:
            val: MD2
            mandatoryInSearch: true
            excludeFromUpdate: false
          Description:
            val: Dados RH Colaboradores MD2
            mandatoryInSearch: false
            excludeFromUpdate: false
          Type:
            val: Unstructured
            mandatoryInSearch: false
            excludeFromUpdate: false

      - label: Event.Group_Ingestion
        props:
          Type:
            val: MD2
            mandatoryInSearch: true
          Operation:
            val: Unstructured Data Insertion
            mandatoryInSearch: true
          Ingestion_Date:
            val: "${new java.text.SimpleDateFormat('yyyy-MM-dd').format(new Date())}"
            mandatoryInSearch: true
          Metadata_Start_Date:
            val: "${new Date()}"
            excludeFromSearch: true
            type: java.util.Date
          Metadata_End_Date:
            val: "${new Date()}"
            excludeFromSearch: true
            type: java.util.Date
    edges:
      - label: "Has_Ingestion_Event"
        fromVertexLabel: "Object.Data_Source"
        toVertexLabel: "Event.Group_Ingestion"

      - label: "Has_Ingestion_Event"
        fromVertexLabel: "Event.Group_Ingestion"
        toVertexLabel: "Event.Ingestion"

      - label: "Has_Ingestion_Event"
        fromVertexLabel: "Person.Natural"
        toVertexLabel: "Event.Ingestion"

      - label: "Has_Id_Card"
        fromVertexLabel: "Person.Natural"
        toVertexLabel: "Object.Identity_Card"

      - label: "Uses_Email"
        fromVertexLabel: "Person.Natural"
        toVErtexLabel: "Object.Email_Address"