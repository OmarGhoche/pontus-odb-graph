---
rules:
  cap_leads:
    vertices:
      - label: Person.Natural
        props:
          Full_Name:
            val: "${First_Name?.trim()?.toUpperCase()} ${Last_Name?.trim()?.toUpperCase()}"
            mandatoryInSearch: true
          Customer_ID: # ?!?!? Lead_Group - Number - Code
            val: "${Lead_ID}"
            mandatoryInSearch: true
          Type:
            val: "Leads"
            excludeFromSearch: true
          Title:
            val: "${Title}"
            excludeFromSearch: true

      - label: Person.Organisation
        condition: "${Company_Name_1?.trim()?.length() > 0}"
        props:
          Name:
            val: "${Company_Name_1?.trim()?.toUpperCase()}"
            mandatoryInSearch: true
          Type:
            val: "Leads"
            excludeFromSearch: true

      - label: Object.Phone_Number
        condition: "${Telephone_no?.trim()?.length() > 0}"
        name: telephone
        props:
          Raw:
            val: "${Telephone_no}"
            mandatoryInSearch: false
          Type:
            val: "Leads"
            excludeFromSubsequenceSearch: true
          Numbers_Only:
            val: "${(Telephone_no?.replaceAll('[^0-9]', '')?:'00000000')}"
            excludeFromSearch: true
            type: "[Ljava.lang.String;"

          Last_7_Digits:
            val: "${(((Telephone_no?.replaceAll('[^0-9]', ''))?:'0000000')[-7..-1])}"
            mandatoryInSearch: true
            type: "[Ljava.lang.String;"

      - label: Object.Phone_Number
        condition: "${Mobile_Number?.trim()?.length() > 0}"
        name: mobile
        props:
          Raw:
            val: "${Mobile_Number}"
            mandatoryInSearch: false
          Type:
            val: "Leads"
            excludeFromSubsequenceSearch: true
          Numbers_Only:
            val: "${(Mobile_Number?.replaceAll('[^0-9]', '')?:'00000000')}"
            excludeFromSearch: true
            type: "[Ljava.lang.String;"

          Last_7_Digits:
            val: "${(((Mobile_Number?.replaceAll('[^0-9]', ''))?:'0000000')[-7..-1])}"
            mandatoryInSearch: true
            type: "[Ljava.lang.String;"

      - label: Location.Address
        condition: "${Company_Name_1?.trim()?.length() > 0}"
        props:
          Full_Address:
            val: "${Street} ${House_Number} ${Street_2?:''}, ${Region}, ${City} - ${Country}, ${Postal_Code}"
#            av. marcio gomes 333, AA3, Belo Horizonte - Brasil, 6758090
            mandatoryInSearch: true
#          Type:
#            val: "Business"
#            excludeFromSearch: true
#          parser:
#            val: "${Street} ${House_Number} ${Street_2?:''}, ${Region}, ${City} - ${Country}, ${Postal_Code}"
#            mandatoryInSearch: true
#            type: "com.pontusvision.utils.LocationAddress"

      - label: Object.Contract
        props:
          Date: "${Status_Since}"
          Description: "${Description}"
          Id: "${Lead_Group} - ${Lead_ID} - ${Number}"
          Status: "${Customer_Status}"
          Type:
            val: "Leads Contract"
            excludeFromSearch: true

      - label: Object.Email_Address
#        condition: "${Email_Address?.trim()?.length() > 0}"
        props:
          Email: "${Email_Address?.trim()?.toLowerCase()}"

      - label: Event.Ingestion
        props:
          Type:
            val: sap/c@p
            excludeFromSearch: true
          Operation:
            val: Structured Data Insertion
            excludeFromSearch: true
          Domain_b64:
            val: "${original_request?.bytes?.encodeBase64()?.toString()}"
            excludeFromSearch: true
          Metadata_Create_Date:
            val: "${new Date()}" # Date COLUMN
            excludeFromSearch: true
            type: java.util.Date
          Metadata_Update_Date:
            val: "${new Date()}"
            excludeFromSearch: true
            type: java.util.Date

      - label: Event.Group_Ingestion
        props:
          Type:
            val: sap/c@p
            mandatoryInSearch: true
          Operation:
            val: Structured Data Insertion
            mandatoryInSearch: true
          Ingestion_Date:
            val: "${new java.text.SimpleDateFormat('yyyy-MM-dd').format(new Date())}"
            mandatoryInSearch: true
          Metadata_Start_Date:
            val: "${new Date()}"
            #            mandatoryInSearch: false
            excludeFromSearch: true
            type: java.util.Date
          Metadata_End_Date:
            val: "${new Date()}"
            excludeFromSearch: true
            type: java.util.Date

      - label: Object.Data_Source
        props:
          Name: sap/c@p
          Type: sap/c@p
          Description: Registros de Leads no SAP/C@P

    edges:
      - label: "Has_Ingestion_Event"
        fromVertexLabel: "Object.Data_Source"
        toVertexLabel: "Event.Group_Ingestion"

      - label: "Has_Ingestion_Event"
        fromVertexLabel: "Event.Group_Ingestion"
        toVertexLabel: "Event.Ingestion"

      - label: "Has_Ingestion_Event"
        fromVertexLabel: "Person.Natural"
        toVertexLabel: "Event.Ingestion"

      - label: "Is_Located"
        fromVertexLabel: "Person.Natural"
        toVertexLabel: "Location.Address"

      - label: "Has_Phone"
        fromVertexLabel: "Person.Natural"
        toVertexName: "telephone"

      - label: "Has_Phone"
        fromVertexLabel: "Person.Natural"
        toVertexName: "mobile"

      - label: "Uses_Email"
        fromVertexLabel: "Person.Natural"
        toVertexLabel: "Object.Email_Address"

      - label: "Is_Lead"
        fromVertexLabel: "Person.Natural"
        toVertexLabel: "Object.Contract"

      - label: "Works"
        fromVertexLabel: "Person.Natural"
        toVertexLabel: "Person.Organisation"